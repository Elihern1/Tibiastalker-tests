<html>
<head>
    <title>features/CharacterSearch/components/SearchForm/SearchForm.tsx</title>
    <style type="text/css" media="screen">
        #editor {
            position: absolute;
            top: 40px;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
</head>
<body style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif">
<h3 style="margin-bottom: 0">features/CharacterSearch/components/SearchForm/SearchForm.tsx (<b>75</b> lines of code) (<a href="SearchForm.tsx">raw</a>):</h3>
<div id="editor">import { useEffect, useRef, useState } from &quot;react&quot;;
import { Button, Col, Dropdown, Form, Row, Spinner } from &quot;react-bootstrap&quot;;
import usePromptList from &quot;../../hooks/usePromptList&quot;;
import { SearchFormProps } from &quot;./types&quot;;

export const SearchForm = ({ onSubmit, isLoading, value }: SearchFormProps) =&gt; {
  const { promptList, getPromptList, clearPromptList } = usePromptList();

  const [inputValue, setInputValue] = useState(value);
  const [isFocusOnInput, setIsFocusOnInput] = useState(false);

  const timeoutRef = useRef&lt;NodeJS.Timeout | null&gt;(null);

  // proteger contre promptList = undefined
  const safePromptList = Array.isArray(promptList) ? promptList : [];

  const updateInputValue = (newValue: string) =&gt; {
    setInputValue(newValue);
    getPromptList(newValue);
  };

  const submit = (valueOverride?: string) =&gt; {
    const finalValue = valueOverride ?? inputValue;

    onSubmit(finalValue);
    setInputValue(finalValue);

    setIsFocusOnInput(false);
    clearPromptList();
  };

  const delayedInputBlur = () =&gt; {
    timeoutRef.current = setTimeout(() =&gt; {
      setIsFocusOnInput(false);
    }, 200);
  };

  const abortInputBlur = () =&gt; {
    if (timeoutRef.current) clearTimeout(timeoutRef.current);
  };

  useEffect(() =&gt; {
    if (value !== inputValue) setInputValue(value);
  }, [value]);

  return (
    &lt;Row&gt;
      &lt;Col className=&quot;p-1&quot;&gt;
        &lt;Form.Control
          type=&quot;text&quot;
          placeholder=&quot;Character Name&quot;
          value={inputValue}
          data-testid=&quot;search-input&quot;
          autoFocus
          onChange={(e) =&gt; updateInputValue(e.target.value)}
          onFocus={() =&gt; setIsFocusOnInput(true)}
          onBlur={delayedInputBlur}
          onKeyDown={(e) =&gt; {
            if (e.key === &quot;Enter&quot;) submit();
          }}
        /&gt;

        &lt;Dropdown.Menu
          show={isFocusOnInput &amp;&amp; safePromptList.length &gt; 0}
          onFocus={abortInputBlur}
        &gt;
          {safePromptList.map((item) =&gt; (
            &lt;Dropdown.Item key={item} onClick={() =&gt; submit(item)}&gt;
              {item}
            &lt;/Dropdown.Item&gt;
          ))}
        &lt;/Dropdown.Menu&gt;
      &lt;/Col&gt;

      &lt;Col xs=&quot;auto&quot; className=&quot;p-1&quot;&gt;
        {isLoading ? (
          &lt;Spinner animation=&quot;border&quot; /&gt;
        ) : (
          &lt;Button
            variant=&quot;outline-info&quot;
            data-testid=&quot;search-button&quot;
            onClick={() =&gt; submit()}
          &gt;
            Search
          &lt;/Button&gt;
        )}
      &lt;/Col&gt;
    &lt;/Row&gt;
  );
};
</div>
<script src="https://www.zeljkoobrenovic.com/tools/common/lib/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.session.setMode("ace/mode/typescript");
    editor.setTheme("ace/theme/xcode");
    editor.setReadOnly(true);
    editor.setOption("wrap", true);
    editor.setPrintMarginColumn(120);
</script>
</body>
